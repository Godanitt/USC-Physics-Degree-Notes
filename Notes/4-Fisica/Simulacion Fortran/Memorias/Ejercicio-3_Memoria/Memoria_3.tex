\documentclass[11pt]{article} % scrbook otro formato
\usepackage[utf8]{inputenc}
\usepackage[spanish,es-tabla,es-nodecimaldot]{babel}

% Paquetes

\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{makeidx}
\usepackage{graphicx}
\usepackage{lmodern}
%\usepackage{kpfonts}
\usepackage{fancyhdr}
\usepackage{geometry}
\usepackage{lastpage}
\usepackage{array} % Para fjar tamaño de columnas
\RequirePackage{siunitx}
\RequirePackage{tcolorbox}
\usepackage{extramarks} % Para poder usar firstleftmarks
\usepackage[version=4]{mhchem} % Para poder usar formulas de reacciones nucleares
\usepackage{xcolor}
\usepackage{booktabs}
%\usepackage{newtxtext, newtxmath} % Cambia la fuente (pero mola)

\newtcolorbox{mybox}{colback=black!5!white,
	colframe=black!75!black}
\newtcolorbox{mybox2}{colback=blue!5!white,
	colframe=black!75!black}
	


%##############################################################################
%######### Ponemos el decimal con . ###########################################
%##############################################################################

\sisetup{output-decimal-marker={.},
	% exponentes ------------------------
	%exponent-mode=threshold,
	%exponent-thresholds=-3:2, % non usar exponentes 10^{-2,-1, 0, 1}
	% redondear -------------------------
	% round-mode=figures, % cifras sig
	% round-mode=places, % cantos decimales
	round-mode=uncertainty, % cifras sig da incerteza (necesario usar erro)
	round-precision=2,
	uncertainty-mode = separate,
	print-unity-mantissa=false,
	% unidades --------------------------
	inter-unit-product = \ensuremath{{}\cdot{}}, % separacion entre unidades
	% per-mode=power-positive-first, % so furrula con metodo interpretado puro
	inline-per-mode=single-symbol,
	display-per-mode=fraction,
}

%##############################################################################
%######### Para codigo python #################################################
%##############################################################################

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\usepackage{listings}


%\lstdefinestyle{mystyle}{	backgroundcolor=\color{backcolour},   	commentstyle=\color{codegreen},	keywordstyle=\color{magenta},	numberstyle=\tiny\color{codegray},	stringstyle=\color{codepurple},	basicstyle=\ttfamily\footnotesize,	breakatwhitespace=false,         	breaklines=true,                 	captionpos=b,                    	keepspaces=true,                 	numbers=left,                    	numbersep=5pt,                  	showspaces=false,                	showstringspaces=false,	showtabs=false,                  	tabsize=2}

%\lstset{style=mystyle}
%\usepackage{background}     % Para manejar el fondo


%##############################################################################
%######### Tipo de fuente #################################################
%##############################################################################

%\usepackage{kpfonts}

%\usepackage{helvet} 
%\renewcommand{\familydefault}{\sfdefault}.

%\usepackage{fontspec} % Paquete necesario para seleccionar fuentes
%\setmainfont{Verdana} % Cambia la fuente principal a Verdana


%##############################################################################
%######### Geometría #################################################
%##############################################################################

\geometry{a4paper, total={163mm,237mm}, left=25.5mm, top=30mm}



%##############################################################################
%######### Formatos capítulo #################################################
%##############################################################################

%\usepackage[lmodern]{quotchap}
%\usepackage[Bjornstrup]{fncychap}

% Para el Bjornstrup
%\ChNumVar{\fontsize{76}{80}\usefont{OT1}{pzc}{m}{n}\selectfont}
%\ChTitleVar{\raggedright\Huge\sffamily\bfseries}


%##############################################################################
%######### Hiperreferenias #################################################
%##############################################################################


\usepackage[colorlinks=true,allcolors=blue]{hyperref} % Crea las


%##############################################################################
%######### Formato de pagina #################################################
%##############################################################################

%\renewcommand{\chaptermark}[1]{\markboth{\chaptername\ \thechapter.\ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection.\ #1}}

\setlength{\headsep}{27pt} % Distancia entre la cabezera y el texto
\setlength{\footskip}{30pt} % Distancia entre el pie de pagina y el texto
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE]{\rightmark} % L,R,C-> left, right, center [LE,RO]
\fancyhead[RO]{\rightmark} % E,O -> even (par), odd (impar)
\fancyhead[LO,RE]{Daniel Vázquez Lago}
\fancyfoot[CE,CO]{\thepage}
\renewcommand{\headrulewidth}{1pt} % Cambiamos el grosor de la linea de arriba
\renewcommand{\footrulewidth}{0pt}



%##############################################################################
%#########  Modificar caption #################################################
%##############################################################################

\usepackage[font=small, justification=centering]{caption}  % Configura las captions



%##############################################################################
%######### Comandos propios #################################################
%##############################################################################

\newcommand{\parentesis}[1]{\left( #1  \right)} 
\newcommand{\parciales}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\pparciales}[2]{\parentesis{\parciales{#1}{#2}}}
\newcommand{\ccorchetes}[1]{\left[ #1  \right]}
\newcommand{\D}{\mathrm{d}}
\newcommand{\derivadas}[2]{\frac{\D #1}{\D #2}}

\newcommand{\tquad}{\quad \quad \quad}
\newcommand{\dquad}{\quad \quad}
\newcommand{\vnabla}{\vec{\nabla}}

\newcommand{\Ocal}{\mathcal{O}}
\newcommand{\Ncal}{\mathcal{N}}
\newcommand{\Hcal}{\mathcal{H}}
\newcommand{\Ucal}{\mathcal{U}}
\newcommand{\Lcal}{\mathcal{L}}

\newcommand{\logd}{\log_{10}}

\newcommand{\eV}{\text{eV}}
\newcommand{\cm}{\text{cm}}
\newcommand{\cmm}{\text{cm}^{-1}}
\newcommand{\fm}{\text{fm}}
\newcommand{\He}{\text{He}}
\newcommand{\p}{\text{p}}
\newcommand{\e}{\text{e}}
\newcommand{\cte}{\text{cte}}


% Comandos vectoriales

\newcommand{\an}{\mathbf{a}}
\newcommand{\bn}{\mathbf{b}}
\newcommand{\dn}{\mathbf{d}}
\newcommand{\jn}{\mathbf{j}}
\newcommand{\lnn}{\boldsymbol{\ell}}
\newcommand{\lnnn}{\boldsymbol{l}}
\newcommand{\kn}{\mathbf{k}}
\newcommand{\pn}{\mathbf{p}}
\newcommand{\qn}{\mathbf{q}}
\newcommand{\rn}{\mathbf{r}}
\newcommand{\sn}{\mathbf{s}}
\newcommand{\un}{\mathbf{u}}
\newcommand{\vn}{\mathbf{v}}
\newcommand{\xn}{\mathbf{x}}
\newcommand{\yn}{\mathbf{y}}
\newcommand{\qndot}{\dot{\qn}}

\newcommand{\unovec}{\vec{\mathbf{1}}}

\newcommand{\alphan}{\boldsymbol{\alpha}}
\newcommand{\sigman}{\boldsymbol{\sigma}}
\newcommand{\pin}{\boldsymbol{\pi}}


\newcommand{\An}{\mathbf{A}}
\newcommand{\Bn}{\mathbf{B}}
\newcommand{\En}{\mathbf{E}}
\newcommand{\Gn}{\mathbf{G}}
\newcommand{\Jn}{\mathbf{J}}
\newcommand{\Kn}{\mathbf{K}}
\newcommand{\Ln}{\mathbf{L}}
\newcommand{\Rn}{\mathbf{R}}
\newcommand{\Sn}{\mathbf{S}}
\newcommand{\Tn}{\mathbf{T}}
\newcommand{\In}{\mathbf{I}}

\newcommand{\hnn}{\hat{\mathbf{n}}}
\newcommand{\hnr}{\hat{\mathbf{r}}}
\newcommand{\hnz}{\hat{\mathbf{z}}}
\newcommand{\hnx}{\hat{\mathbf{x}}}
\newcommand{\hny}{\hat{\mathbf{y}}}
\newcommand{\hnu}{\hat{\mathbf{u}}}
\newcommand{\hnR}{\hat{\mathbf{R}}}
\newcommand{\hnv}{\hat{\mathbf{v}}}
\newcommand{\hnk}{\hat{\mathbf{k}}}
\newcommand{\hni}{\hat{\mathbf{i}}}
\newcommand{\hnj}{\hat{\mathbf{j}}}
\renewcommand{\hnk}{\hat{\mathbf{k}}}

\newcommand{\Ec}{\langle E_c \rangle}
\newcommand{\Ecinv}{\langle E_c^{-1} \rangle}
\newcommand{\varphiV}{\langle \varphi_V \rangle}
\newcommand{\varphiVV}{\langle \varphi_{VV}\rangle}
\newcommand{\varphiVEcinv}{\langle \varphi_V E_c^{-1} \rangle}
\newcommand{\varphiVVEcinv}{ \langle \varphi_V^2 E_c^{-1} \rangle}

%##############################################################################
%######### Teoremas/definiciones #################################################
%##############################################################################

%\theoremstyle{definition}
%\newtheorem{definition}{Definición}[chapter]
%\theoremstyle{theorem}
%\newtheorem{theorem}{Teorema}[chapter]




%##############################################################################
%######### Referncia para euccaiones y figuras ################################
%##############################################################################

%\numberwithin{equation}{section}
%\numberwithin{figure}{section}




%##############################################################################
%######### Documento #################################################
%##############################################################################


\author{Daniel Vazquez Lago}
\title{Simulación en física de materiales}


\begin{document}	
	
\maketitle
\newpage
\tableofcontents

\setlength{\parskip}{1.5mm} % Cambia el espacio entre párrafos


	
\section{Objetivos}


El objetivo de esta segunda entrega de la asignatura es obtener el valor de las diferentes propiedades termodinámicas de un gas (infinito) modelizado mediante un potencial de Lennard-Jones en la colectividad microcanónica. Para calcular las propiedades termodinámicas el sistema deberá estar en el equilibrio\footnote{Partimos de la configuración obtenida del obligatorio 2, que como se verificó en el optativo 1, está en el equilibrio, por lo que no habrá problema en este sentido.}. 


\section{Propiedades termodinámicas: teoría}

En esta sección trataremos de obtener las expresiones de las propiedades termodinámicas mas importantes a partir de los que podemos obtener a lo largo de la simulación, como pueden ser la energía cinética, la energía potencial, sus derivadas respecto al volumen... con unidades. Hay que tener en cuenta que toda la derivación se ha hecho en la colectividad microcanónica, de la que haremos una breve descripción. Tras esto veremos como serán las ecuaciones en las variables reducidas y que son las variables reducidas, que son realmente las ecuaciones que podremos implementar en el programa. 

\subsection{Propiedades termodinámicas}

Para obtener las propiedades termodinámicas deseadas necesitamos realizar un cálculo bastante tedioso, que se puede encontrar en el Apéndice C del Haile \cite{Haile} (páginas 340-346). 

\subsubsection{Colectividad microcanónica: espacio de fases y valores medios}

La colectividad microcanónica, a diferencia de las otras colectividades, considera un sistema totalmente aislado, que conserva en el tiempo el número de partículas $N$, el volumen $V$ y la energía $E$ (por eso muchas veces se llama NVE a esta colectividad). Sin embargo nosotros también imponemos que el momento total del sistema debe ser cero ($\pn_t=0$), por lo que el \textbf{número total de grados de libertad} $f$ pasa de ser $3N$ a $3(N-1)$, lo cual nosotros tendremos en cuenta, a diferencia del Haile, que afirma que ``para simulaciones de más de 100 partículas podemos ignorar esta corrección''. 


Veamos como se define entonces el valor medio de cualquier propiedad y en particular como se define la entropía del sistema. Para obtener cualquiera de estos valores tendremos que conocer cual es el volumen del espacio de fases $\Omega$, que de manera muy resumida contabiliza el número de estados posibles del sistema. En la colectividad microcanónica con $f$ grados de libertad viene dada por:

\begin{equation}
	\Omega =  C \int \D \rn^N \D \pn^N \theta [E-\Hcal]
\end{equation}
donde  $C$ les una constante que depende del número de partículas y de la constante de Planck, $\theta$ la función escalón de Heavside y $\Hcal$ el hamiltonaino dado por 

\begin{equation}
	\Hcal = \Hcal (\rn^N, \pn^N) = E_c (\pn^N) + E_p(\rn^N) \label{Ec:02-01-02}
\end{equation}
donde $E_c$ es la energía cinética y $E_p$ la potencial. La densidad de estados $\omega$, que nos da una medida de cuantos estados hay en un intervalo diferencial de energía, viene dada por:

\begin{equation}
	\omega = \parentesis{\parciales{\Omega}{E}}_{NV} = C \int \D \rn^N \D \pn^N \delta (E-\Hcal)
\end{equation}
Entonces el valor medio de una variable termodinámica cualquiera $A(\rn^N,\pn^N)$ viene dada por la siguiente ecuación

\begin{equation}
	\langle A \rangle = \frac{C}{\omega}  \int \D \rn^N \D \pn^N  A(\rn^N,\pn^N) \delta (E-\Hcal)
\end{equation}
que podemos expresar con palabras de la siguiente manera: el valor medio de una propiedad cualquiera es la suma\footnote{Recordemos que una integral no es más que una suma.} de cada uno de los posibles valores de $A$ sobre los estados en los que se puede encontrar el sistema (esto es, aquellos que verifiquen $\Hcal = E$) entre el número de estados válidos para dicha energía. Por otro lado la entropía $S$ en la colectividad microcanónica viene dada por  ($k$ es la constante de Boltzmann)

\begin{equation}
	S=k \ln \Omega \label{Ec:02-01-05}
\end{equation}

\subsubsection{Integración sobre el momento}

En algunos casos, como puede ser el de los gases ideales (no hay potencial) la integral sobre el momento y sobre $\omega$ puede ser sencillo, sin embargo no siempre será así, ya que en otros casos (como el nuestro) las posiciones y los momentos están acoplados por la ecuación (\ref{Ec:02-01-02}). Para desacoplar la integral y poder resolver las integrales necesarias necesitaremos usar la \textit{transformada de Laplace}. El procedimiento es el siguiente:

\begin{enumerate}
	\item Obtener la integral de Laplace sobre $\Omega$ respecto la energía $E$.
	\item Integrar sobre el momento.
	\item Hacer la transformación inversa.
\end{enumerate}

Las transformadas de Laplace de la función escalón y de la función delta son:

\begin{equation}
	L[\theta(t-a)] = \int_{0}^{\infty} \theta [t-a] e^{st} \D t = \frac{1}{s} e^{-sa}
\end{equation}
\begin{equation}
	L[\delta(t-a)] = \int_{0}^{\infty} \delta [t-a] e^{st} \D t =e^{-sa} 
\end{equation}
Para $\Omega$ la transformada de Laplace debe ser entonces:

\begin{equation}
	L[\Omega] = C \int \D \rn^N \D \pn^N \frac{1}{s} e^{-s\Hcal} 
\end{equation}
ahora separando $\Hcal$ en los componentes cinético y potencial (\ref{Ec:02-01-02}) tenemos que

\begin{equation}
	L[\Omega] = C \int \D \rn^N \D \pn^N \frac{1}{s} e^{-sE_c}e^{-sE_p} \label{Ec:02-01-09}
\end{equation}
Podemos separar la integral de los momentos y de las posiciones, y como $E_c=\sum_i \pn_i^2/2m$ esto nos lleva a 

\begin{equation}
	\int \D \pn^N \exp \ccorchetes{- \frac{s}{2m} \sum_i \pn_i^2} =  \parentesis{\frac{2\pi m}{s}}^{f/2}
\end{equation}
que es una integral trivial. Es importante mencionar que \textit{es en este paso y no en otro donde debemos tener en cuenta los grados de libertad}, donde realmente cobra importancia la imposición de $\sum \pn = 0$. Ahora substituimos esto en la ecuación (\ref{Ec:02-01-09}) y tenemos que:

\begin{equation}
	L[\Omega] = C  \parentesis{\frac{2\pi m}{s}}^{f/2} \int \D \rn^N \frac{1}{s} \exp [-sE_p] \label{Ec:02-01-11}
\end{equation}
Ahora solo queda tener en cuenta que la transformada inversa de $\exp[-sk]/s^n$ viene dada por 

\begin{equation}
	L^{-1} \parentesis{\frac{\exp \ccorchetes{-sk}}{s^n}} = \theta [t-k] \frac{(t-k)^{n-1}}{\Gamma [n]} \label{Ec:02-01-12}
\end{equation}
donde hemos $\Gamma [n] = (n-1)!$ es la función gamma. Aplicando la transformada inversa (\ref{Ec:02-01-12}) sobre (\ref{Ec:02-01-11}) tenemos que:

\begin{equation}
	\Omega = C \frac{1}{\Gamma[f/2+1]} \int \D \rn^N (E-E_p)^{f/2} \theta [E-E_p]
\end{equation}
donde hemos aplicado $C (2\pi m)^{f/2}\rightarrow C$. De esta forma podemos obtener la densidad de estados $\omega$ simplemente haciendo la derivada respecto $E$, tal que 

\begin{equation}
	\omega = \frac{C}{\Gamma[f/2]} \int \D \rn^N (E-E_p)^{f/2-1} \theta [E-E_p]
\end{equation}
Así, para una cantidad $A(\rn^N)$ que solo dependa de las posiciones: 

\begin{equation}
	\langle A \rangle = C \frac{1}{\Gamma[f/2] \omega} \int \D \rn^N (E-E_p)^{f/2-1} A(\rn^N) \theta [E-E_p]
\end{equation}
o lo que es lo mismo

\begin{equation}
	\langle A \rangle = \frac{\int \D \rn^N (E-E_p)^{f/2-1} A(\rn^N) \theta [E-E_p]}{\int \D \rn^N (E-E_p)^{f/2-1}\theta [E-E_p]}
\end{equation}

Una vez tenemos esto calcular el valor de las propiedades medias que queramos será trivial, solo necesitamos conocer las expresiones de la termodinámica clásica y derivar.



\subsubsection{Temperatura}
La temperatura en un sistema en equilibrio viene dada por 
\begin{equation}
	\frac{1}{T} = \parentesis{\parciales{S}{E}}_{V,N}
\end{equation}
que aplicando la definición de entropía anteriormente dada (\ref{Ec:02-01-05}) podemos ver que

\begin{equation}
	\frac{1}{kT} = \parentesis{\parciales{\ln \Omega}{E}}_{V,N} =  \frac{1}{\Omega} \parentesis{\parciales{\Omega }{E}}_{NV} = \frac{\omega}{\Omega}
\end{equation}
Ahora, como podemos ver esto nos lleva a que: 

\begin{equation}
	kT = \frac{\Gamma[f/2]}{\Gamma[f/2+1]} \frac{\int \D \rn^N (E-E_p)^{f/2}\theta [E-E_p] }{\int \D \rn^N (E-E_p)^{f/2-1}\theta [E-E_p]}
\end{equation}
Podemos identificar $E_c = E - E_p$, tal que $(E-E_p)^{f/2} = (E-E_p)^{f/2-1} (E-E_p)$ de tal modo que la expresión de la derecha no resulta otra cosa que la media de la energía cinética, tal que 


\begin{equation}
	T = \frac{2 \langle E_c \rangle}{kf}
\end{equation}

\subsubsection{Capacidad calorífica a volumen constante}

La capacidad calorífica a volumen constante viene dada por:

\begin{equation}
	C_V = \parentesis{\parciales{E}{T}}_{NV}
\end{equation}
Como sabemos 

\begin{equation}
	\parentesis{\parciales{1/T}{E}}_{NV} = \frac{-1}{T^2} \parentesis{\parciales{T}{E}}_{NV} = \parentesis{\parciales{^2S}{E^2}}_{NV}
\end{equation}
Calculamos el término de la derecha:

\begin{equation}
	\parentesis{\parciales{^2S}{E^2}}_{NV} = \parentesis{ \parciales{}{E} \parentesis{\parciales{S}{E}}}_{NV} = \parentesis{\parciales{}{E} \parentesis{\frac{k}{\Omega}\parciales{\Omega}{E} }}_{NV}
\end{equation}
lo que nos lleva a que:

\begin{equation}
	\parentesis{\parciales{^2S}{E^2}}_{NV} =  -\frac{k}{\Omega^2} \parentesis{\parciales{\Omega}{E}}^2 + \frac{k}{\Omega} \parentesis{\parciales{^2 \Omega}{E^2}} = \frac{1}{kT^2} + \frac{1}{T}\parentesis{\frac{f}{2}-1} \langle E_c^{-1} \rangle
\end{equation}
que haciendo cálculos los lleva a que 

\begin{equation}
	-\parentesis{\parciales{T}{E}}_{NV} = - \frac{1}{k} + T \parentesis{\frac{f}{2}-1} \langle E_c^{-1}\rangle
\end{equation}
substituyendo la expresión de la temperatura calculada anteriormente

\begin{equation}
	-\parentesis{\parciales{T}{E}}_{NV} = - \frac{1}{k} + \frac{2\langle E_c \rangle}{kf} \parentesis{\frac{f}{2}-1} \langle E_c^{-1}\rangle
\end{equation}
ahora solo tenemos que ver, efectivamente 

\begin{equation}
	C_V  = \frac{k}{1+\parentesis{\frac{2}{f}-1} \langle E_c \rangle \langle E_c^{-1}\rangle}
\end{equation}

\subsubsection{Presión}

La presión viene dada por 

\begin{equation}
	\frac{P}{T} = \parentesis{\parciales{S}{V}}_{NE} = 
	\frac{k}{\Omega} \parentesis{\parciales{\Omega}{V}}_{NE} 
\end{equation}	
lo que nos lleva a que:

\begin{equation}
	P = \frac{1}{\omega} \parentesis{\parciales{\Omega}{V}}_{NE}  = \frac{NkT}{V} - \left\langle \parciales{E_p}{V} \right\rangle
\end{equation}



\subsubsection{Resumen}

Calcular todas nos llevaría una cantidad de páginas bastante grande, y un tiempo valioso del que no disponemos. Hemos calculado las más básicas, y las siguientes, aunque tengan expresiones intrincadas se pueden calcular exactamente de la misma manera. En este subapartado vamos a hacer un resumen de todas las que queremos calcular a partir de los valores medios de interés, que son, en resumen

\begin{mybox}
	\begin{equation}
		\langle E_c \rangle \dquad \langle E_c^{-1} \rangle  \dquad \langle \varphi_V \rangle  \dquad \langle \varphi_V E_c^{-1} \rangle \dquad \langle \varphi_V^2 E_c^{-1} \rangle \dquad \langle \varphi_{VV}\rangle \label{Ec:02-01-30}
	\end{equation}
\end{mybox}	
A partir de estas podemos calcular los valores medios de las propiedades termodinámicas

\begin{mybox}
\begin{equation}
	 T = \frac{2\Ec}{kf} \dquad P = \frac{NkT}{V} - \langle \varphi_V \rangle \dquad C_V = \frac{k}{\ccorchetes{1+\parentesis{\frac{2}{f}-1}}\Ec \Ecinv}   \label{Ec:02-01-31}
\end{equation}
\begin{equation*}
\alpha_E  = \frac{k}{V\ccorchetes{\parentesis{1-\frac{2}{f}}\Ec \varphiVEcinv - \varphiV }} \dquad
	\gamma  = \frac{Nk}{C_V} + V \parentesis{\frac{f}{2} -1} \ccorchetes{\varphiV \Ecinv - \varphiVEcinv}  
\end{equation*}
\begin{equation*}
	\frac{1}{k_s} = \frac{NkT}{V} \ccorchetes{1+2\gamma - \frac{Nk}{C_V}} + V \varphiVV  - V\parentesis{\frac{f}{2} -1} \ccorchetes{\varphiVVEcinv - 2 \varphiV \varphiVEcinv + \varphiV^2 \Ecinv}
\end{equation*}
\end{mybox}	
Y a partir de estas magnitudes calculamos las propiedades restantess

\begin{mybox}
	\begin{equation}
		\alpha_P = \frac{C_V}{V} \gamma k_T \dquad \alpha_S = - \frac{1}{\gamma T} \dquad \frac{1}{\alpha_E} = \frac{PV}{C_V} - \gamma T \label{Ec:02-01-32}
	\end{equation}
	\begin{equation*}
		\frac{1}{k_T} = \frac{1}{k_S} - \frac{TC_V}{V} \gamma^2 \dquad C_p = C_V \frac{k_T}{k_S}
	\end{equation*}
\end{mybox}

\subsection{Variables reducidas}

Las variables reducidas en el modelo de Lennard-Jones (nuestro modelo) se usan para simplificar la descripción de propiedades de sistemas de partículas en interacción, como gases y líquidos. Este modelo describe las interacciones entre partículas mediante un potencial que depende de dos parámetros: la energía de interacción $\varepsilon$ y la distancia característica $\sigma$ (el volumen reducido se expresaría como $V^*=V/\sigma^3$). Para reducir el número de parámetros en las ecuaciones, se introducen unidades reducidas que normalizan las magnitudes físicas (como temperatura, distancia y energía). La temperatura se normaliza usando la constante de Boltzmann $k$. Este tipo de análisis se parece mucho al que hacemos en relatividad general y espacial con las ``unidades naturales'' haciendo que $c=1$ y por tanto es equivalente hablar de posición y tiempo, de tal manera que para recuperar el tiempo solo debemos dividir entre $c$. 


Sin embargo, aunque desde un punto analítico es interesante para embellecer y simplificar las ecuaciones, cuando hacemos simulaciones usar variables reducidas se vuelve fundamental, ya que el ordenador no entiende de unidades, y cuantas mas constantes haya en medio de las ecuaciones más lenta será la simulación. Por tanto nosotros, una vez fijadas $\varepsilon,\sigma,k$ tenemos que:

\begin{equation*}
	T^* = (k/\varepsilon) T \dquad P^* =(\sigma^3 / \varepsilon)  P  \dquad C_V^* = C_V/k \dquad \gamma^* = \gamma \dquad \frac{1}{k_s^*} =\parentesis{\frac{\sigma^3}{\varepsilon}} \frac{1}{k_s}  \dquad E^*=E/\varepsilon
\end{equation*}
\begin{equation*}
	\alpha_P^* = (\varepsilon/k_B) \alpha_P \dquad
	\alpha_S^* = (\varepsilon/k_B) \alpha_S \dquad
	\alpha_E^* = (\varepsilon/k_B) \alpha_E \dquad
	\frac{1}{k_T^*} = \parentesis{\frac{\sigma^3}{\varepsilon}} \frac{1}{k_T} \dquad C_P^*=C_P/k
\end{equation*}
de este modo las ecuaciones que realmente vamos a implementar serán las anteriores pero en reducidas, esto es:

\begin{equation*}
	T^* = \frac{2\Ec^*}{f} \dquad P^* = \frac{NT^*}{V^*} - \langle \varphi_V \rangle^* \dquad C_V^* = \frac{1}{\ccorchetes{1+\parentesis{\frac{2}{f}-1}}\Ec^* \Ecinv^*}   
\end{equation*}
\begin{equation*}
	\alpha_E^*  = \frac{1}{V^*\ccorchetes{\parentesis{1-\frac{2}{f}}\Ec^* \varphiVEcinv^* - \varphi^* }} \dquad \gamma^*  = \frac{N}{C_V^*} + V^* \parentesis{\frac{f}{2} -1} \ccorchetes{\varphiV^* \Ecinv^* - \varphiVEcinv^*}  
\end{equation*}
\begin{equation*}
	\frac{1}{k_s^*} = \frac{NT^*}{V^*} \ccorchetes{1+2\gamma^* - \frac{N}{C_V^*}} + V^* \varphiVV^*  - V^*\parentesis{\frac{f}{2} -1} \ccorchetes{\varphiVVEcinv^* - 2 \varphiV^* \varphiVEcinv^* + (\varphiV^*)^2 \Ecinv^*}
\end{equation*}
\begin{equation*}
	\alpha_P^* = \frac{C_V^*}{V^*} \gamma^* k_T^* \dquad \alpha_S^* = - \frac{1}{\gamma^* T^*} \dquad \frac{1}{\alpha_E^*} = \frac{P^*V^*}{C_V^*} - \gamma^* T^* 
\end{equation*}
\begin{equation*}
	\frac{1}{k_T^*} = \frac{1}{k_S^*} - \frac{T^*C_V^*}{V^*} (\gamma^*)^2 \dquad C_p^* = C_V^* \frac{k_T^*}{k_S^*}
\end{equation*}

\section{Implementación} \label{Sec:04}

En la anterior sección hemos obtenido las expresiones de la temperatura, presión... en función de diferentes valores medios (energía cinética, derivada de la energía potencial respecto al volumen...). Sin embargo nosotros lo que tenemos no son valores medios propiamente dichos, nosotros lo que conocemos son dichos valores para diferentes instantes de tiempo, es decir, conocemos los valores medios pero en el tiempo. Para poder relacionar los valores medios anteriormente calculados con los valores medios a lo largo de un tiempo tendremos que suponer que nuestro sistema es \textit{ergódico}, esto es, que a lo largo de un tiempo suficientemente grande el sistema pasa por todos los posibles puntos del espacio fásico. Por ejemplo la energía cinética verificará que

\begin{equation*}
	\Ec^* = \frac{1}{k_{\text{pasos}}} \sum_{k=1}^{k_{\text{pasos}}} E_c^*(t+k\cdot\Delta t)
\end{equation*}
si $k_{\text{pasos}}$ es lo \textit{suficientemente grande}. Una vez asumimos la hipótesis ergódica, podremos calcular tras un número de interacciones un valor suficientemente grande el valor medio (500K pasos será suficiente). Si hacemos esto con cada uno de los valores de la ecuación (\ref{Ec:02-01-30}), tras estos 500K pasos podremos obtener un valor de las propiedades de interés (\ref{Ec:02-01-31}), y luego los valores de (\ref{Ec:02-01-32}). Sin embargo lo que nosotros vamos a realizar no son solo 500K pasos, si no que haremos una simulación de 5M (es probable que acabemos haciendo más) de pasos divida en 10 interacciones de 500K pasos, obteniendo entonces 10 valores de la temperatura, 10 valores de la presión... 

Ahora la pregunta que nos surge es: ¿Por qué hacemos esto así? Pues bien, esto se hace porque todo experimento debe tener una incertidumbre. Cuando nosotros medimos en el laboratorio la presión somos quienes de darle, con mayor o menor certeza, una incertidumbre a la medida o a los resultados inferidos tras una muestra. Sin embargo nosotros en la simulación no podemos hacer eso, por lo que la única manera de hacerlo es suponer que los valores medios de las propiedades termodinámicas obtenidas con 500K pasos son equivalentes a una medida experimental, de tal manera que nosotros trabajaremos \textit{como si} lo que tenemos fuera una muestra de 10 valores de la variable termodinámica X, de lo que inferir una media $\bar{X}$ y una incertidumbre $s(X)$. Entonces las propiedades termodinámicas derivadas (\ref{Ec:02-01-32}) se calcularán, en realidad, como valores inferidos de la muestra, y por tanto la incertidumbre tendrá que ser calculada con la ecuación de propagación de errores, que abordaremos en el apartado \ref{Subsec:03-01}.



\subsection{Valores medios e incertidumbres} \label{Subsec:03-01}


Dado que nosotros vamos obtener varios valores de cada una de las propiedades (\ref{Ec:02-01-31}), vamos a poder obtener una incertidumbre tratando cada uno de los valores como si fueran independientes entre sí. Así, tendremos que el valor medio de $X$ (siendo $X$ cualquier magnitud termodinámica en reducidas):

\begin{equation}
	 \overline{X} = \frac{1}{N}\sum_{i=1}^{N} X_i
\end{equation}
donde $N$ es el número de valores y $X_i$ el valor $i$ de la muestra. La incertidumbre de la muestra:

\begin{equation}
	\sigma_X = \sqrt{\frac{\sum_{i=1}^{N} \parentesis{X_i-\overline{X}}^2 }{N-1}}
\end{equation}
Y la incertidumbre de la media

\begin{equation}
	s(\overline{X}) = \frac{\sigma_X}{\sqrt{N}}
\end{equation}
Esto implica que cuanto más datos $X$ tomemos (es decir, cuantas más simulaciones hagamos), menor será la incertidumbre de la media. La covariancia entre dos muestras $\{ X \}$ y $\{ Z \}$ viene dada por 

\begin{equation}
	\sigma_{XZ} = \sqrt{ \frac{\sum_{i=1}^N (X_i-\bar{X})(Z_i-\bar{Z})}{N-1}}
\end{equation} 
Sea $Y$ un valor que viene determinado por una función $Y(Z_1,Z_2...,Z_N)$. Si $\sigma_{ii} \equiv \sigma_{i}^2$ es la incertidumbre de la variable $Z_i$ al cuadrado y $\sigma_{ij}$ la convariancia entre $Z_i$ y $Z_j$ ($i\neq j$) la \textit{formula de propagación de incertidumbres} nos asegura que la incertidumbre del valor $Y$ viene dado por

\begin{equation}
	\sigma_Y = \sqrt{\sum_{i=1}^N \sum_{j=1}^{N} \parentesis{\parciales{Z_i}{Y}}\parentesis{\parciales{Z_j}{Y}} \sigma_{ij} }
\end{equation} 
De aquí se pueden deducir entonces las expresiones de las incertidumbres para las variables (\ref{Ec:02-01-32}) a partir de las variables (\ref{Ec:02-01-31}). Si suponemos que las variables son independientes entre sí podemos suponer que las convarianzas son cero, y por tanto que nuestras expresiones son (en variables reducidas todo)

\begin{equation}
	\sigma_{k_S} = (k_S^{-1})^{-2} \sigma_{k_S^{-1}}
\end{equation}
\begin{equation}
	\sigma_{k_T^{-1}} =\sqrt{(1/k_S^2)^2 \sigma_{k_S}^2+ (C_V\gamma^2/V)^2 \sigma_{T}^2+ (T\gamma^2/V)^2 \sigma_{C_V}^2+ (2TC_V\gamma/V)^2 \sigma_{\gamma}^2}
\end{equation}
\begin{equation}
	\sigma_{k_T} = (k_T^{-1})^{-2} \sigma_{k_T^{-1}}
\end{equation}
\begin{equation}
	\sigma_{\alpha_P} = \frac{1}{V} \sqrt{(C_V\gamma)^2 \sigma_{k_T}^2+ (\gamma k_T)^2 \sigma_{C_V}^2 + (C_V k_T)^2 \sigma_{\gamma}^2}
\end{equation}
\begin{equation}
	\sigma_{\alpha_S} =\sqrt{(1/\gamma T^2)^2 \sigma_{T}^2+ (1/\gamma^2 T)^2 \sigma_{\gamma}^2}
\end{equation}

\begin{equation}
	\sigma_{\alpha_E^{-1}} =\sqrt{(V/C_V)^2\sigma_P^2+(VP/C_V^2)^2 \sigma_{C_V}^2 +T^2  \sigma_{\gamma}^2 + \gamma^2 \sigma_T^2}
\end{equation}
\begin{equation}
\sigma_{\alpha_{E2}} = (\alpha_E^{-1})^{-2} \sigma_{\alpha_E^{-1}}
\end{equation}


\begin{equation}
	\sigma_{C_p} =\sqrt{(k_T/k_S)^2 \sigma_{C_V}^2 + (C_V/k_S)^2 \sigma_{k_T}^2 + (C_Vk_T /k_S^2)^2 \sigma_{k_S}^2}
\end{equation}



\subsection{Organización} \label{Subsec:02}

En este apartado mencionare que archivos se han usado a lo largo del proyecto y como está organizado. En primer lugar hay que decir que, por motivos de organización personal, he creado una carpeta llamada \textit{Datos} donde se almacenan todos los \texttt{.dat} de todos los proyectos. Sin embargo para que se guarden correctamente he supuesto que se ejecuta desde el proyecto, esto es, desde el \texttt{.exe} que se genera al construir el proyecto. De hacerlo de otro modo esto llevaría a un error. En segundo lugar, se puede ver que tal y como recomendó el profesor, hay una carpeta donde guardo todos los archivos \texttt{.f95} (llamada \textit{Programas fuente}) y otra donde esta el proyecto \texttt{.ftn95p}, para así poder reusarlos y que esté bien ordenado. Una breve descripción de los archivos de fortran usados

\begin{itemize}
	\item \textbf{Mod\_01\_Def\_prec}: modulo usado para definir las precisiones doble precisión y entero, permitiéndo usar datos con más cifras decimales.
	\item \textbf{Mod\_02\_Variables\_comunes}: nos permite pasar las variables comunes entre las diferentes subrutinas y programas sin necesidad de definirlos en los propios programas.
	\item \textbf{Mod\_03\_Interface}: módulo que nos permite detectar errores a la hora de introducir datos en las subrutinas, así como detectarlos en las variables de salida de las mismas.
	\item \textbf{Sub\_Potlj:} subrutina en la cual introducimos las posiciones y el número de partículas como variables de entrada y nos devuelve las aceleraciones/fuerzas, así como la energía potencial del sistema y sus derivadas respecto al volumen (primera y segunda).
	\item \textbf{Sub\_Verlet:} subrutina la cual recibe una configuración inicial en el instante $t$ y devuelve la nueva configuración inicial en $t+\Delta t$ (para esto esta subrutina llama a \texttt{Sub\_Potlj}). Además también obtenemos con ella la energía potencial.
	\item \textbf{Pro\_Simulacion:} programa principal. Su principal función es leer la configuración inicial (siempre debe partir de una configuración en equilibrio), y mediante un lazo ir llamando a la subrutina Verlet. Con cada interacción (o cada cierto número de interacciones) almacenaremos los diferentes valores que luego serán usados para calcular el promedio de las variables termodinámicas. Al final de cada interacción guarda los valores medios de las propiedades termodinámicas (y otros valores de interés, como energía total y potencial medias) en un \texttt{.dat}, además de guardar la configuración final.
	\item \textbf{Pro\_Medias:} recoge los valores medios escritos a lo largo de la simulación y calcula la media y la incertidumbre. Además también calcula el valor medio de las magnitudes derivadas (aquellas que se calculan a partir de los valores medios de otras propiedades) así como su incertidumbre. Este programa no se encuentra \textit{dentro del proyecto}, es un ejecutable independiente.
\end{itemize}
Además también usaremos un archivo a lotes (\texttt{.bat}):

\begin{itemize}
	\item \textbf{Ejectuta\_DM}: en este archivo de lotes es en el que realmente ejecutamos la dinámica molecular, ejecutando el \texttt{.exe} un cierto número de veces (10 en principio) escribiendo el valor de entrada que necesita la simulación para trabajar.
\end{itemize}
Dado que la organización es más complicada que en anteriores entregas, recomendamos leer pausadamente la sección \ref{Sec:04}, ya que se podrá entender mejor la razón por la cual hemos creado un archivo de lotes y por la que hay varios ejecutables.

\subsection{Procedimiento}

Entonces, una vez tenemos en cuenta todo lo mencionado hasta ahora, el procedimiento seguido para hallar los resultados es el siguiente:

\begin{enumerate}
	\item Ejecutamos el archivo de lotes, de tal manera que genera una simulación de 5M de pasos, dividida en 10 interacciones, almacenando en cada interacción los valores medios de la temperatura, presión, capacidad calorífica a volumen constante, coeficiente adiabático, modulo de compresibildiad reducido, energía total media, energía cinética media, energía potencial media. En total tendremos 10 de cada uno de estos valores en un archivo \texttt{.dat} en dos archivos llamados \texttt{Datos\_valores\_medios\_energias.dat} y \texttt{Datos\_valores\_medios}.
	
	\item Una vez tenemos los archivos, ejecutamos el programa \texttt{Pro\_Calcula\_medias.f95} que con los valores anteriores obtiene la media de la muestra de cadad una de estos datos, las incertidumbres de la media y los valores derivados. 
	
	\item Ejecutamos un archivo de Python que lee los datos y los transforma en una tabla en latex. 
\end{enumerate}


\section{Resultados}

\begin{table}[h!] \centering
\include{Tabla1.tex}
\caption{Valores medios y la incertidumbre asociada ($2\cdot \sigma$).}
\label{Tab:01}
\end{table}

\begin{table}[h!] \centering
\include{Tabla2.tex}
\caption{Valores obtenidos para cada interacción de 500K pasos.}
\label{Tab:02}
\end{table}
\section{Conclusiones}


\bibliography{Bibliografia.bib}
\bibliographystyle{unsrt}
	

\end{document}	
